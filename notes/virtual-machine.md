### Java 虚拟机

#### 类的加载机制

1. 类的生命周期包括：加载（Loading），验证（Verificaion），准备（Preparation），解析（Resolution），初始化（Initialization），使用（Using）和卸载（Unloading）7个阶段。其中验证，准备，解析3个部分统称为连接。
2. 加载，验证，准备，初始化，卸载这5个阶段的顺序是确定的，类的加载过程必须按照这种顺序按部就班地“开始”（注意是开始，不是“进行”或“完成”），而解析阶段在某些情况下可以在初始化阶段之后再“开始”，这是为了支持Java语言的运行时绑定。

#### 初始化条件

1. 遇到new，getstatic，putstatic或invokestatic这四条指令时，如果类没有初始化，需要先触发其初始化。这四条指令的一般场景：使用new关键字实例化对象，读取或者设置类的静态字段（被final修饰的静态字段除外，final静态字段在编译阶段就已经将这个字段值放入调用类的常量池中，因此调用时不需要找到被调用类，只需要在调用类的常量池中找就可以），以及调用类的静态方法。
2. 使用java.lang.reflect包的方法对类进行反射调用的时候。
3. 初始化类时，父类还没有初始化，先初始化父类（接口在初始化时，不要求将父接口全部完成初始化，只有真正用到时才会初始化）。
4. 虚拟机启动时，用户指定的执行主类需要先初始化。

#### 加载

在加载阶段，虚拟机需要完成3件事情：
1. 通过一个类的全限定名来获取定义此类的二进制字节流；
2. 将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构；
3. 在内存中生成一个代表该类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口。

#### 验证

验证阶段大致完成四个阶段的检验阶段：
1. 文件格式验证：验证字节流是否符合Class文件格式的规范，并且能被当前版本虚拟机处理。
